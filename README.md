# ğŸ¤– Purchasing Workflow Automation (n8n + LLM)

This repository provides an anonymised, reproducible version of the automation system described in Evidence 5 â€“ LLM + n8n Automation for Purchasing Workflow.

It demonstrates how CSV-based stock snapshots, supplier and item history documents, and structured examples are orchestrated through n8n and a multi-agent LLM pipeline to produce:

1. Purchasing Analysis Report (DOCX) â€” stored in the â€œAnalysis-reportâ€ folder  
2. Purchase Request Document (DOCX) â€” one file per supplier, saved into â€œPurchase-requestâ€  
3. Supplier Email Drafts (DOCX) â€” supplier-facing drafts saved into â€œEmail-draftâ€  

All output files follow the naming pattern: YYYY-MM-DD_SupplierName.docx.  
All data is anonymised. The structure mirrors the production purchasing environment.

---

## 1. System Overview

**Layer 1**
<img width="1222" height="521" alt="Layer1" src="https://github.com/user-attachments/assets/d10d1697-4c9d-40c1-8858-715fc99a681a" />

<br>

**Layer 2**
<img width="1297" height="586" alt="Layer2" src="https://github.com/user-attachments/assets/295d6a31-b0ea-4d08-8d29-9761cd9ea4ea" />


The automation converts a daily CSV snapshot into complete purchasing artefacts:

â€¢ Internal analysis report â€” structured insights and risk assessments  
â€¢ Purchase request (PR) draft â€” grouped by supplier for approval workflows  
â€¢ Supplier email drafts â€” external communication requesting timelines or availability  

The workflow integrates:

â€¢ CSV ingestion  
â€¢ Retrieval of supplier and item history via vector stores  
â€¢ Example-guided formatting using analysis/request/email templates  
â€¢ A multi-agent LLM pipeline  
â€¢ Automatic export to document folders via n8n  

---

## 2. Architecture

High-level flow:

1. CSV Snapshot â†’ JS Computation Layer  
   - Extracts snapshot date  
   - Groups items by supplier  
   - Computes suggested PO timelines and quantities using lead-time windows and depletion trends  

2. Analysis Agent  
   - Reads supplier and item history documents  
   - Produces structured analytical JSON per supplier  

3. Downstream Agents  
   - Report Document Agent â†’ internal purchasing report  
   - PR Draft Agent â†’ purchase-request JSON  
   - PR Document Agent â†’ formatted PR document  
   - Email Draft Agent â†’ supplier-facing email draft  

4. Output Delivery  
   - Final DOCX files are written into: Analysis-report, Purchase-request, Email-draft  

---

## 3. n8n Workflow

The workflow JSON file is located at:

n8n/purchasing_automation_workflow.json

Components include:

â€¢ Manual trigger used for demonstration, simulating the sequence normally initiated by a new CSV snapshot  
â€¢ Folder ingestion for: Input, Supplier-history, Item-history, Analysis-examples, Request-examples, Email-examples  
â€¢ Text extraction â†’ embedding â†’ vector-store ingestion  
â€¢ Analysis, PR Draft, PR Document and Email Draft agents  
â€¢ Automated DOCX export into the appropriate output folders  

To import into n8n:

1. Open n8n  
2. Create a new workflow  
3. Select â€œImport from Fileâ€ and choose the JSON  
4. Update API/file-storage credentials as needed  

---

## 4. Data & Vector Stores

The repository mirrors the original Google Drive structure.

### 4.1 Input CSVs  
Folder: data/Input/

Typical columns:

â€¢ ItemCode  
â€¢ ItemName  
â€¢ SupplierName  
â€¢ RiskLevel  
â€¢ CurrentStock  
â€¢ WksToOOS  

CSV files are named according to their snapshot date.

### 4.2 Vector Store Documents

â€¢ Supplier-history â€” delivery issues, supplier performance notes, escalation history  
â€¢ Item-history â€” demand patterns, packaging or quality issues  
â€¢ Analysis-examples â€” example internal reports used as structural guidance  
â€¢ Request-examples â€” example purchase request documents  
â€¢ Email-examples â€” example supplier-facing communication formats  

These documents are used to build vector-store context for the LLM agents.

---

## 5. Prompts & Pseudocode

Located in:

docs/prompts/

Each file contains:

â€¢ Input schema specification  
â€¢ Output JSON/text format  
â€¢ Behavioural guardrails and constraints  

---

## 6. Example Outputs

Produced by the automated workflow and stored in:

data/Analysis-report/  
data/Purchase-request/  
data/Email-draft/  

These examples match the artefacts generated by the workflow using anonymised sample data.

---

## 7. Repository Structure

```
purchasing-workflow-automation-n8n-llm/
â”œâ”€ n8n/
â”‚  â””â”€ purchasing_automation_workflow.json
â”œâ”€ data/
â”‚  â”œâ”€ Input/
â”‚  â”œâ”€ Supplier-history/
â”‚  â”œâ”€ Item-history/
â”‚  â”œâ”€ Analysis-examples/
â”‚  â”œâ”€ Request-examples/
â”‚  â”œâ”€ Email-examples/
â”‚  â”œâ”€ Analysis-report/
â”‚  â”œâ”€ Purchase-request/
â”‚  â””â”€ Email-draft/
â”œâ”€ docs/
â”‚  â”œâ”€ screenshots/
â”‚  â””â”€ prompts/
â””â”€ README.md
```

This structure reflects the real purchasing automation workflow in a safe, anonymised form suitable for GTV evidence documentation.
